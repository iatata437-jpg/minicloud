<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>MiniCloud ‚Äì –ü–∞–Ω–µ–ª—å</title>

    <link rel="stylesheet" href="style.css">

    <style>
        /* ---------------- –¢–ï–ú–´ –ß–ï–†–ï–ó CSS-–ü–ï–†–ï–ú–ï–ù–ù–´–ï ---------------- */
        :root {
            --bg-color: #e8efff;
            --bg2-color: #f7f2ff;
            --panel-bg: #ffffff;
            --text-color: #000000;
            --border-color: #dddddd;
            --th-bg: #fafafa;
            --tr-hover: #f8f5ff;
            --file-input-bg: #f3f3f3;
            --btn-bg: #6a5acd;
            --btn-text: #ffffff;
            --delete-bg: #ff5d5d;
            --delete-bg-hover: #ff3d3d;
            --logout-bg: #d9534f;
            --logout-hover: #c9302c;
        }

        .dark {
            --bg-color: #121212;
            --bg2-color: #121212;
            --panel-bg: #1f1f1f;
            --text-color: #ffffff;
            --border-color: #2e2e2e;
            --th-bg: #262626;
            --tr-hover: #2f2f2f;
            --file-input-bg: #292929;
            --btn-bg: #8a7aff;
            --btn-text: #ffffff;
            --delete-bg: #ff4444;
            --delete-bg-hover: #ff2222;
            --logout-bg: #b52a27;
            --logout-hover: #9d1c19;
        }

        body {
            background: linear-gradient(135deg, var(--bg-color), var(--bg2-color));
            margin: 0;
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            padding-top: 40px;
            color: var(--text-color);
            transition: 0.3s ease;
        }

        .panel-container {
            width: 900px;
            background: var(--panel-bg);
            border-radius: 18px;
            padding: 35px;
            box-shadow: 0 0 40px rgba(0,0,0,0.10);
            transition: 0.3s ease;
        }

        h2 {
            margin: 0 0 25px;
            font-size: 28px;
            text-align: center;
            color: var(--text-color);
        }

        .upload-box {
            margin: 20px 0;
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        input[type="file"] {
            background: var(--file-input-bg);
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            font-size: 15px;
            width: 65%;
            color: var(--text-color);
        }

        button {
            padding: 12px 20px;
            background: var(--btn-bg);
            color: var(--btn-text);
            border: none;
            border-radius: 10px;
            font-size: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: .2s;
        }

        button:hover {
            opacity: 0.85;
        }

        #progress {
            width: 100%;
            height: 10px;
            background: #eee;
            border-radius: 6px;
            overflow: hidden;
            margin: 20px 0;
            display: none;
        }

        #progress div {
            height: 100%;
            background: var(--btn-bg);
            width: 0%;
            transition: width 0.1s;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
        }

        th, td {
            padding: 14px;
            border-bottom: 1px solid var(--border-color);
            font-size: 15px;
            color: var(--text-color);
        }

        th {
            background: var(--th-bg);
            font-weight: 600;
        }

        tr:hover {
            background: var(--tr-hover);
        }

        a {
            color: var(--btn-bg);
            font-weight: 600;
        }

        .delete-btn {
            background: var(--delete-bg);
            padding: 8px 14px;
            border-radius: 8px;
            color: white;
        }

        .delete-btn:hover {
            background: var(--delete-bg-hover);
        }

        .logout-btn {
            margin-top: 20px;
            float: right;
            background: var(--logout-bg);
            padding: 8px 16px;
            border-radius: 8px;
        }

        .logout-btn:hover {
            background: var(--logout-hover);
        }

        /* –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã */
        #themeToggle {
            position: fixed;
            right: 20px;
            bottom: 20px;
            background: var(--btn-bg);
            color: var(--btn-text);
            border: none;
            padding: 10px 14px;
            border-radius: 50px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            transition: 0.3s;
        }

        #themeToggle:hover {
            opacity: 0.8;
        }
    </style>
</head>

<body>

<!-- –ö–Ω–æ–ø–∫–∞ —Ç–µ–º—ã -->
<button id="themeToggle">üåì</button>

<div class="panel-container">

    <h2>–í–∞—à–∏ —Ñ–∞–π–ª—ã</h2>

    <div class="upload-box">
        <input type="file" id="fileInput">
        <button onclick="upload()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
    </div>

    <div id="progress"><div></div></div>

    <table>
        <thead>
        <tr>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞</th>
            <th>–†–∞–∑–º–µ—Ä</th>
            <th>–°–∫–∞—á–∞—Ç—å</th>
            <th>–£–¥–∞–ª–∏—Ç—å</th>
        </tr>
        </thead>
        <tbody id="fileTable"></tbody>
    </table>

    <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>

</div>

<script>
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
    const token = localStorage.getItem("token");
    if (!token) location.href = "/index.html";

    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark");
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
    document.getElementById("themeToggle").onclick = () => {
        document.body.classList.toggle("dark");
        localStorage.setItem("theme",
            document.body.classList.contains("dark") ? "dark" : "light"
        );
    };

    // –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
    function logout() {
        localStorage.removeItem("token");
        location.href = "/index.html";
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
    async function loadFiles() {
        const res = await fetch('/files', {
            headers: { 'Authorization': token }
        });

        const data = await res.json();
        const table = document.getElementById("fileTable");
        table.innerHTML = "";

        data.files.forEach(file => {
            table.innerHTML += `
                <tr>
                    <td>${file.name}</td>
                    <td>${(file.size / 1024 / 1024).toFixed(2)} MB</td>
                    <td>
                        <a href="/files/${file.name}" 
                           onclick="event.preventDefault(); downloadFile('${file.name}')">
                           –°–∫–∞—á–∞—Ç—å
                        </a>
                    </td>
                    <td><button class="delete-btn" onclick="deleteFile('${file.name}')">–£–¥–∞–ª–∏—Ç—å</button></td>
                </tr>
            `;
        });
    }

    function downloadFile(name) {
        fetch(`/files/${name}`, {
            headers: { "Authorization": token }
        })
        .then(res => res.blob())
        .then(blob => {
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = name;
            a.click();
        });
    }

    async function deleteFile(name) {
        if (!confirm(`–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª "${name}"?`)) return;

        await fetch('/files/' + name, {
            method: 'DELETE',
            headers: { 'Authorization': token }
        });

        loadFiles();
    }

    function upload() {
        const file = document.getElementById("fileInput").files[0];
        if (!file) return alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª!");

        const formData = new FormData();
        formData.append("file", file);

        const progress = document.getElementById("progress");
        const bar = progress.firstElementChild;

        progress.style.display = "block";
        bar.style.width = "0%";

        const req = new XMLHttpRequest();
        req.open("POST", "/upload");
        req.setRequestHeader("Authorization", token);

        req.upload.onprogress = e => {
            if (e.lengthComputable) {
                bar.style.width = (e.loaded / e.total * 100) + "%";
            }
        };

        req.onload = () => {
            progress.style.display = "none";
            loadFiles();
        };

        req.send(formData);
    }

    loadFiles();
</script>

</body>
</html>
